<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>ILC to App interface | ilc-sdk</title>
	<meta name="description" content="Documentation for ilc-sdk">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="../../assets/css/main.css">
	<link rel="stylesheet" href="../../assets/css/pages.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="../../assets/js/search.json" data-base="../..">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="../../index.html" class="title">ilc-sdk</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="../../modules.html">Globals</a>
				</li>
				<li>
					<a href="ilc_app_interface.html">Pages</a>
				</li>
				<li>
					<a href="ilc_app_interface.html">ILC to App interface</a>
				</li>
			</ul>
			<h1>ILC to App interface</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#ilc-to-app-interface" id="ilc-to-app-interface" style="color: inherit; text-decoration: none;">
					<h1>ILC to App interface</h1>
				</a>
				<p>This document aims to describe communication interface used by ILC
				to talk to apps (micro frontends).</p>
				<a href="#client-side-interface" id="client-side-interface" style="color: inherit; text-decoration: none;">
					<h2>Client side interface</h2>
				</a>
				<p>During the course of a single-spa page, registered applications are loaded, bootstrapped (initialized), mounted, unmounted, and unloaded.
				ILC (with the help of the <a href="https://single-spa.js.org/">single-spa</a>) provides hooks into each phase via <code>lifecycles</code>.</p>
				<p>See more information about the <a href="https://single-spa.js.org/docs/building-applications/#lifecyle-props">lifecycle functions here</a>.</p>
				<p>TS interface for custom props that are passed to every lifecycle function
				<a href="https://namecheap.github.io/ilc-sdk/interfaces/app.applifecyclefnprops.html">can be found here</a>.</p>
				<a href="#init-code-during-app-bundle-loading" id="init-code-during-app-bundle-loading" style="color: inherit; text-decoration: none;">
					<h3>Init code during app bundle loading</h3>
				</a>
				<p>Sometimes you need to run some initialization code right after app bundle will be loaded in the browser and usually you
				want to be able to pass some configuration properties to that code.</p>
				<p>ILC allows you to export a function called <code>mainSpa(props)</code> that will receive application properties that were defined in
					<em>Registry</em> in it&#39;s first argument.
				This function should return an object with &quot;single-spa&quot; <a href="https://single-spa.js.org/docs/building-applications/#lifecyle-props">lifecycle functions</a>.</p>
				<p><strong>Example of possible use case:</strong></p>
				<pre><code class="language-javascript"><span style="color: #008000">// File specified as Webpack entry point</span>
<span style="color: #AF00DB">export</span><span style="color: #000000"> </span><span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #795E26">mainSpa</span><span style="color: #000000"> = (</span><span style="color: #001080">props</span><span style="color: #000000">) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #AF00DB">if</span><span style="color: #000000"> (</span><span style="color: #001080">props</span><span style="color: #000000">.</span><span style="color: #001080">publicPath</span><span style="color: #000000">) {</span>
<span style="color: #000000">        </span><span style="color: #001080">__webpack_public_path__</span><span style="color: #000000"> = </span><span style="color: #001080">props</span><span style="color: #000000">.</span><span style="color: #001080">publicPath</span><span style="color: #000000">;</span>
<span style="color: #000000">    } </span><span style="color: #AF00DB">else</span><span style="color: #000000"> {</span>
<span style="color: #000000">        </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">warn</span><span style="color: #000000">(</span><span style="color: #A31515">`Can&#039;t determine value of the &quot;__webpack_public_path__&quot;, falling back to default one...`</span><span style="color: #000000">);</span>
<span style="color: #000000">    }</span>

<span style="color: #000000">    </span><span style="color: #AF00DB">return</span><span style="color: #000000"> </span><span style="color: #795E26">require</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;./app-bootstrap&#039;</span><span style="color: #000000">); </span><span style="color: #008000">// Returns: {bootstrap: () =&gt; {}, mount: () =&gt; {}, unmount: () =&gt; {}}</span>
<span style="color: #000000">};</span>
</code></pre>
				<a href="#server-side-interface" id="server-side-interface" style="color: inherit; text-decoration: none;">
					<h2>Server side interface</h2>
				</a>
				<blockquote>
					<p><strong>Note:</strong> keep in mind that Server side interface integration is necessary only for isomorphic micro frontend. However
					ILC also supports apps that have client side rendering only.</p>
				</blockquote>
				<a href="#low-level-ilc-lt-gt-micro-frontend-interface" id="low-level-ilc-lt-gt-micro-frontend-interface" style="color: inherit; text-decoration: none;">
					<h3>Low level ILC &lt;-&gt; Micro Frontend interface</h3>
				</a>
				<p>This is the description of the server side ILC &lt;-&gt; Micro Frontend interface which is implemented by this library in a form
				of SDK.</p>
				<a href="#input-interface-ilc--gt-micro-frontend" id="input-interface-ilc--gt-micro-frontend" style="color: inherit; text-decoration: none;">
					<h4>Input interface ILC -&gt; Micro Frontend</h4>
				</a>
				<p>With every request for SSR content from the app ILC sends the following meta-information:</p>
				<ol>
					<li><p>Query parameter <code>routerProps</code></p>
						<p>Contains base64 encoded JSON object with the following keys:</p>
						<ul>
							<li><p><code>basePath</code> - Base path that is relative to the matched route.</p>
								<p>So for <code>reqUrl = /a/b/c?d=1</code> &amp; matched route <code>/a/*</code> base path will be <code>/a/</code>.
								While for <code>reqUrl = /a/b/c?d=1</code> &amp; matched route <code>/a/b/c</code> base path will be <code>/a/b/c</code>.</p>
							</li>
							<li><p><code>reqUrl</code> - Request URL string. This contains only the URL that is present in the actual HTTP request. It <strong>DOES NOT</strong> contain information about locale.</p>
								<p><code>reqUrl</code> = <code>/status?name=ryan</code> if the request is:</p>
								<pre><code><span style="color: #0070C1">GET</span><span style="color: #000000"> /</span><span style="color: #001080">status</span><span style="color: #000000">?</span><span style="color: #001080">name</span><span style="color: #000000">=</span><span style="color: #001080">ryan</span><span style="color: #000000"> </span><span style="color: #0070C1">HTTP</span><span style="color: #000000">/</span><span style="color: #098658">1.1</span><span style="color: #000000">\</span><span style="color: #001080">r</span><span style="color: #000000">\</span><span style="color: #001080">n</span>
<span style="color: #001080">Accept</span><span style="color: #000000">: </span><span style="color: #001080">text</span><span style="color: #000000">/</span><span style="color: #001080">plain</span><span style="color: #000000">\</span><span style="color: #001080">r</span><span style="color: #000000">\</span><span style="color: #001080">n</span>
<span style="color: #000000">\</span><span style="color: #001080">r</span><span style="color: #000000">\</span><span style="color: #001080">n</span>
</code></pre>
							</li>
							<li><p><em>(legacy)</em> <code>fragmentName</code> - string with name of the fragment</p>
							</li>
						</ul>
					</li>
					<li><p>Query parameter <code>appProps</code></p>
						<p>Sent only if app has some <em>Props</em> defined at the app or route slot level.
						Contains base64 encoded JSON object with defined <em>Props</em>.</p>
					</li>
					<li><p>Header <code>x-request-uri</code>. Request URL string. This contains only the URL that is present in the actual HTTP request. It <strong>may contain</strong> information about locale.</p>
					</li>
					<li><p>Optional header <code>x-request-intl</code>. Present only if ILC runs with Intl feature enabled. Format is described <a href="src/server/IlcProtocol.ts">here</a>.</p>
					</li>
				</ol>
				<p>Both query params mentioned here can be decoded in the following manner:</p>
				<pre><code class="language-javascript"><span style="color: #267F99">JSON</span><span style="color: #000000">.</span><span style="color: #795E26">parse</span><span style="color: #000000">(</span><span style="color: #001080">Buffer</span><span style="color: #000000">.</span><span style="color: #795E26">from</span><span style="color: #000000">(</span><span style="color: #001080">req</span><span style="color: #000000">.</span><span style="color: #001080">query</span><span style="color: #000000">.</span><span style="color: #001080">routerProps</span><span style="color: #000000">, </span><span style="color: #A31515">&#039;base64&#039;</span><span style="color: #000000">).</span><span style="color: #795E26">toString</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;utf-8&#039;</span><span style="color: #000000">))</span>
</code></pre>
				<a href="#response-interface-micro-frontend--gt-ilc" id="response-interface-micro-frontend--gt-ilc" style="color: inherit; text-decoration: none;">
					<h4>Response interface Micro Frontend -&gt; ILC</h4>
				</a>
				<p>App possible response headers:</p>
				<ul>
					<li><code>Link</code> - Check <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Link">reference</a>.</li>
					<li><code>x-head-title</code> - <em>(only primary app)</em> Page title encoded with base64. Will be injected onto <code>&lt;head&gt;</code> tag.
					Ex: <code>Buffer.from(&#39;&lt;title&gt;Page title&lt;/title&gt;&#39;, &#39;utf-8&#39;).toString(&#39;base64&#39;)</code></li>
					<li><code>x-head-meta</code> - <em>(only primary app)</em> Page <a href="https://www.w3schools.com/tags/tag_meta.asp">meta tags</a> encoded with base64.
					Ex: <code>Buffer.from(&#39;&lt;meta name=&quot;description&quot; content=&quot;Free Web tutorials&quot;&gt;&lt;meta name=&quot;keywords&quot; content=&quot;HTML,CSS,XML,JavaScript&quot;&gt;&#39;, &#39;utf-8&#39;).toString(&#39;base64&#39;)</code></li>
				</ul>
				<p>HTTP status code from the primary app will be used to define HTTP status code of the requested page.</p>
				<a href="#app-wrappers" id="app-wrappers" style="color: inherit; text-decoration: none;">
					<h5>App Wrappers</h5>
				</a>
				<p>If Micro Frontend has been registered as &quot;App Wrapper&quot; it can respond in a special format to forward SSR request to the target
				application. To do so app need to return <code>210</code> HTTP status code with following headers available:</p>
				<ul>
					<li><code>x-props-override</code> - Props which will override values returned by getCurrentPathProps() for target app.
					Ex: <code>Buffer.from(JSON.stringify(propsOverride)).toString(&#39;base64&#39;))</code></li>
				</ul>
				<p>See <a href="https://github.com/namecheap/ilc-demo-apps/tree/master/apps/wrapper">wrapper application</a> in ILC Demo apps for
				sample use of the functionality.</p>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="label pp-nav pp-group">
						<span>Pages</span>
					</li>
					<li class="current pp-nav pp-page">
						<a href="ilc_app_interface.html">ILC to <wbr>App interface</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="global_api.html">ILC <wbr>Global API</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="registry_api.html">ILC <wbr>Registry API</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="public_path.html">Public <wbr>Path <wbr>Problem</a>
					</li>
					<li class="label pp-nav pp-group">
						<span>API</span>
					</li>
					<li class=" ">
						<a href="../../modules.html">Modules</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../modules/app.html">app</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../modules/server.html">server</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
				<li class="tsd-kind-type-alias"><span class="tsd-kind-icon">Type alias</span></li>
				<li class="tsd-kind-type-alias tsd-has-type-parameter"><span class="tsd-kind-icon">Type alias with type parameter</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-interface"><span class="tsd-kind-icon">Interface</span></li>
				<li class="tsd-kind-interface tsd-has-type-parameter"><span class="tsd-kind-icon">Interface with type parameter</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-enum"><span class="tsd-kind-icon">Enumeration</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="../../assets/js/main.js"></script>
<script>if (location.protocol == 'file:') document.write('<script src="../../assets/js/search.json"><' + '/script>');</script>
</body>
</html>