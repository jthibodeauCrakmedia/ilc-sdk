<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Public Path Problem | ilc-sdk</title>
	<meta name="description" content="Documentation for ilc-sdk">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="../../assets/css/main.css">
	<link rel="stylesheet" href="../../assets/css/pages.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="../../assets/js/search.json" data-base="../..">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="../../index.html" class="title">ilc-sdk</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="../../modules.html">Globals</a>
				</li>
				<li>
					<a href="ilc_app_interface.html">Pages</a>
				</li>
				<li>
					<a href="public_path.html">Public Path Problem</a>
				</li>
			</ul>
			<h1>Public Path Problem</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#public-path-problem" id="public-path-problem" style="color: inherit; text-decoration: none;">
					<h1>Public Path Problem</h1>
				</a>
				<p>Usually in micro-frontends environment you have each app deployed separately and so
				assets for different apps reside under different base public URLs.</p>
				<p>Let&#39;s imagine that we have App1 and App2 and we deploy their assets to CDN <code>https://cdn.com</code>.
				This can bring us to the following files structure at CDN:</p>
				<pre><code><span style="color: #000000">- </span><span style="color: #001080">app1</span>
<span style="color: #000000">  |- </span><span style="color: #001080">main</span><span style="color: #000000">.</span><span style="color: #001080">a34gf</span><span style="color: #000000">.</span><span style="color: #001080">js</span>
<span style="color: #000000">  |- </span><span style="color: #001080">chunk0</span><span style="color: #000000">.</span><span style="color: #001080">nvfg4</span><span style="color: #000000">.</span><span style="color: #001080">js</span>
<span style="color: #000000">  |- </span><span style="color: #001080">main</span><span style="color: #000000">.</span><span style="color: #001080">fg45s</span><span style="color: #000000">.</span><span style="color: #001080">css</span>
<span style="color: #000000">  |- </span><span style="color: #001080">assets</span>
<span style="color: #000000">     |- </span><span style="color: #001080">logo</span><span style="color: #000000">.</span><span style="color: #001080">df45</span><span style="color: #000000">.</span><span style="color: #001080">png</span>
<span style="color: #000000">- </span><span style="color: #001080">app2</span>
<span style="color: #000000">  |- </span><span style="color: #001080">main</span><span style="color: #000000">.</span><span style="color: #001080">wgr5a</span><span style="color: #000000">.</span><span style="color: #001080">js</span>
<span style="color: #000000">  |- </span><span style="color: #001080">chunk0</span><span style="color: #000000">.</span><span style="color: #001080">sdt54</span><span style="color: #000000">.</span><span style="color: #001080">js</span>
<span style="color: #000000">  |- </span><span style="color: #001080">main</span><span style="color: #000000">.</span><span style="color: #001080">jh63g</span><span style="color: #000000">.</span><span style="color: #001080">css</span>
<span style="color: #000000">  |- </span><span style="color: #001080">assets</span>
<span style="color: #000000">     |- </span><span style="color: #001080">logo</span><span style="color: #000000">.</span><span style="color: #001080">df45</span><span style="color: #000000">.</span><span style="color: #001080">png</span><span style="color: #000000">     </span>
</code></pre>
				<p>Considering that it&#39;s not the best practice to hardcode absolute URLs right within JS/CSS bundle
					(as it makes built code environment dependent) - we need to keep only relative URLs in the bundle and <a href="https://webpack.js.org/guides/public-path/#on-the-fly">supply basic
				public path URL at runtime</a>.</p>
				<p>In our example App1 should receive <code>https://cdn.com/app1/</code> while App2 requires <code>https://cdn.com/app2/</code> to function
				correctly.</p>
				<a href="#tricky-ssr" id="tricky-ssr" style="color: inherit; text-decoration: none;">
					<h2>Tricky SSR</h2>
				</a>
				<p>Fortunately modern Webpack 5 supports <a href="https://webpack.js.org/guides/public-path/#automatic-publicpath">automatic detection</a> of the public path at runtime (based on the URL of the JS file).
				Or similar can be achieved with the use of <a href="https://github.com/joeldenning/systemjs-webpack-interop#as-a-webpack-plugin">SystemJSPublicPathWebpackPlugin</a>.</p>
				<p>However, all those approaches does not support SSR. All of them use URL of the currently executed JS file in order to
				try to determine public path of the bundle, and you simply don&#39;t have that data available during SSR.</p>
				<a href="#why-public-path-is-important" id="why-public-path-is-important" style="color: inherit; text-decoration: none;">
					<h2>Why Public Path is important</h2>
				</a>
				<p>There are several reasons we need it to be set correctly, here are some of them.</p>
				<p><strong>Client side rendering</strong></p>
				<ul>
					<li>Generation of the links to static assets (images, fonts, audio, video) imported into bundle and then extracted to separate files via <code>file-loader</code>.</li>
					<li>Dynamic loading of the bundle chunks when using <a href="https://webpack.js.org/guides/code-splitting/">code splitting</a>.</li>
				</ul>
				<p><strong>Server side rendering</strong></p>
				<ul>
					<li>Generation of the links to static assets (images, fonts, audio, video) imported into bundle and then extracted to separate files via <code>file-loader</code>.</li>
					<li>Synchronization of the CSR/SSR JS bundle to make sure that we use matching pair of the CSR &amp; SSR code.</li>
				</ul>
				<a href="#recommended-solution-from-ilc" id="recommended-solution-from-ilc" style="color: inherit; text-decoration: none;">
					<h2>Recommended solution from ILC</h2>
				</a>
				<a href="#client-side-bundle-configuration" id="client-side-bundle-configuration" style="color: inherit; text-decoration: none;">
					<h3>Client side bundle configuration</h3>
				</a>
				<p>All you need to do to configure public path for your CSR bundle - is to use <code>WebpackPluginsFactory</code> from <a href="https://github.com/namecheap/ilc-sdk">ILC SDK</a>.</p>
				<pre><code class="language-javascript"><span style="color: #008000">// webpack.js</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">ilcWebpackPluginsFactory</span><span style="color: #000000"> = </span><span style="color: #795E26">require</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;ilc-sdk&#039;</span><span style="color: #000000">).</span><span style="color: #001080">WebpackPluginsFactory</span><span style="color: #000000">;</span>

<span style="color: #267F99">module</span><span style="color: #000000">.</span><span style="color: #267F99">exports</span><span style="color: #000000"> = {</span>
<span style="color: #000000">    </span><span style="color: #001080">entry:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;src/client.entry.js&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">output:</span><span style="color: #000000"> {</span>
<span style="color: #000000">        </span><span style="color: #001080">filename:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;app.js&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">        </span><span style="color: #001080">libraryTarget:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;system&#039;</span><span style="color: #000000">,</span>
<span style="color: #000000">    },</span>
<span style="color: #000000">    </span><span style="color: #001080">module:</span><span style="color: #000000"> { </span><span style="color: #008000">/* ... */</span><span style="color: #000000"> },</span>
<span style="color: #000000">    </span><span style="color: #001080">plugins:</span><span style="color: #000000"> </span><span style="color: #795E26">ilcWebpackPluginsFactory</span><span style="color: #000000">().</span><span style="color: #001080">client</span><span style="color: #000000">,</span>
<span style="color: #000000">};</span>
</code></pre>
				<p>This plugin will set bundle&#39;s public path automatically using current URL of the JS file. So if main chunk of your JS bundle
				has URL <code>https://cdn.com/teamA/app1/index.fhg3r.js</code> - public path will be <code>https://cdn.com/teamA/app1/</code>.</p>
				<p>If you need have JS bundle at <code>https://cdn.com/app1/js/index.fhg3r.js</code> and want public path to equal <code>https://cdn.com/app1/</code> -
				pass the following props to the <a href="https://namecheap.github.io/ilc-sdk/modules/server.html#webpackpluginsfactory">ilcWebpackPluginsFactory</a>:</p>
				<pre><code class="language-javascript"><span style="color: #795E26">ilcWebpackPluginsFactory</span><span style="color: #000000">({</span>
<span style="color: #000000">    </span><span style="color: #001080">publicPathDetection:</span><span style="color: #000000"> {</span>
<span style="color: #000000">        </span><span style="color: #001080">rootDirectoryLevel:</span><span style="color: #000000"> </span><span style="color: #098658">2</span>
<span style="color: #000000">    }</span>
<span style="color: #000000">}).</span><span style="color: #001080">client</span>
</code></pre>
				<a href="#server-side-bundle-configuration" id="server-side-bundle-configuration" style="color: inherit; text-decoration: none;">
					<h3>Server side bundle configuration</h3>
				</a>
				<p>Unfortunately it&#39;s virtually impossible to provide consistent with CSR solution that would work with every framework/use case. So for now we&#39;ve decided to
				step away of the CSR/SSR consistent solution and use Node.js app environment variables as a source of public path for SSR bundle.</p>
				<p>It works by setting <code>ILC_APP_PUBLIC_PATH</code> environment variable to the process in which you execute your SSR.</p>
				<p>This variable will be picked up by code injected by <code>ilcWebpackPluginsFactory().server</code> Webpack plugins.
				To make it work - you need to do the following:</p>
				<pre><code class="language-javascript"><span style="color: #008000">// webpack.server.js</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">ilcWebpackPluginsFactory</span><span style="color: #000000"> = </span><span style="color: #795E26">require</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;ilc-sdk&#039;</span><span style="color: #000000">).</span><span style="color: #001080">WebpackPluginsFactory</span><span style="color: #000000">;</span>
<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">path</span><span style="color: #000000"> = </span><span style="color: #795E26">require</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;path&#039;</span><span style="color: #000000">);</span>


<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">config</span><span style="color: #000000"> = </span><span style="color: #795E26">require</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;./webpack.js&#039;</span><span style="color: #000000">);</span>

<span style="color: #001080">config</span><span style="color: #000000">.</span><span style="color: #001080">entry</span><span style="color: #000000"> = </span><span style="color: #A31515">&#039;src/server.entry.js&#039;</span><span style="color: #000000">;</span>
<span style="color: #001080">config</span><span style="color: #000000">.</span><span style="color: #001080">target</span><span style="color: #000000"> = </span><span style="color: #A31515">&#039;node&#039;</span><span style="color: #000000">;</span>
<span style="color: #001080">config</span><span style="color: #000000">.</span><span style="color: #001080">output</span><span style="color: #000000">.</span><span style="color: #001080">filename</span><span style="color: #000000"> = </span><span style="color: #A31515">&#039;server.js&#039;</span><span style="color: #000000">;</span>
<span style="color: #001080">config</span><span style="color: #000000">.</span><span style="color: #001080">output</span><span style="color: #000000">.</span><span style="color: #001080">libraryTarget</span><span style="color: #000000"> = </span><span style="color: #A31515">&#039;commonjs2&#039;</span><span style="color: #000000">;</span>

<span style="color: #001080">config</span><span style="color: #000000">.</span><span style="color: #001080">plugins</span><span style="color: #000000"> = </span><span style="color: #795E26">ilcWebpackPluginsFactory</span><span style="color: #000000">().</span><span style="color: #001080">server</span><span style="color: #000000">;</span>
<span style="color: #001080">config</span><span style="color: #000000">.</span><span style="color: #001080">externals</span><span style="color: #000000"> = [];</span>

<span style="color: #267F99">module</span><span style="color: #000000">.</span><span style="color: #267F99">exports</span><span style="color: #000000"> = </span><span style="color: #001080">config</span><span style="color: #000000">;</span>
</code></pre>
				<p>It&#39;s up to the App developers to choose how to deliver value of the <code>ILC_APP_PUBLIC_PATH</code> environment variable to the app process.</p>
				<p>Also there is an option to customize construction of the public path from the env variable. It&#39;s useful when you run dozens of apps
				which store their assets at the same CDN. To achieve that - pass the following parameters to <code>ilcWebpackPluginsFactory</code>:</p>
				<pre><code class="language-javascript"><span style="color: #795E26">ilcWebpackPluginsFactory</span><span style="color: #000000">({</span>
<span style="color: #000000">    </span><span style="color: #001080">publicPathDetection:</span><span style="color: #000000"> {</span>
<span style="color: #000000">        </span><span style="color: #001080">ssrPublicPath:</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;https://${process.env.CDN_DOMAIN}/app-folder/&#039;</span>
<span style="color: #000000">    }</span>
<span style="color: #000000">}).</span><span style="color: #001080">server</span><span style="color: #000000">;</span>
</code></pre>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="label pp-nav pp-group">
						<span>Pages</span>
					</li>
					<li class=" pp-nav pp-page">
						<a href="ilc_app_interface.html">ILC to <wbr>App interface</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="global_api.html">ILC <wbr>Global API</a>
					</li>
					<li class=" pp-nav pp-page">
						<a href="registry_api.html">ILC <wbr>Registry API</a>
					</li>
					<li class="current pp-nav pp-page">
						<a href="public_path.html">Public <wbr>Path <wbr>Problem</a>
					</li>
					<li class="label pp-nav pp-group">
						<span>API</span>
					</li>
					<li class=" ">
						<a href="../../modules.html">Modules</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../modules/app.html">app</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="../../modules/server.html">server</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
				<li class="tsd-kind-type-alias"><span class="tsd-kind-icon">Type alias</span></li>
				<li class="tsd-kind-type-alias tsd-has-type-parameter"><span class="tsd-kind-icon">Type alias with type parameter</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-interface"><span class="tsd-kind-icon">Interface</span></li>
				<li class="tsd-kind-interface tsd-has-type-parameter"><span class="tsd-kind-icon">Interface with type parameter</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-enum"><span class="tsd-kind-icon">Enumeration</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="../../assets/js/main.js"></script>
<script>if (location.protocol == 'file:') document.write('<script src="../../assets/js/search.json"><' + '/script>');</script>
</body>
</html>